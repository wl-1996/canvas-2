{"version":3,"sources":["main.js"],"names":["canvas","document","getElementById","ctx","getContext","brush","eraser","undo","reSetCanvas","save","colorBtn","getElementsByClassName","range","clear","lWidth","autoSetSize","setCanvasBg","fillStyle","strokeStyle","listenToUser","getColor","window","onbeforeunload","canvasSetSize","clientWidth","documentElement","clientHeight","width","height","onresize","color","fillRect","drawPoint","x","y","clip","clearRect","restore","beginPath","arc","Math","PI","fill","console","log","drawLine","x1","y1","x2","y2","lineWidth","lineCap","lineJoin","globalCompositeOperation","moveTo","lineTo","stroke","closePath","painting","lastPoint","undefined","body","ontouchstart","e","imageData","getImageData","saveData","touches","clientX","clientY","ontouchmove","newPoint","ontouchend","onmousedown","onmousemove","onmouseup","onchange","value","onclick","classList","add","remove","i","length","j","style","backgroundColor","history","shift","push","alert","putImageData","pop","imgUrl","toDataURL","a","createElement","appendChild","href","download","Date","getTime","target","click"],"mappings":"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","file":"main.8dff0f28.js","sourceRoot":"..\\src","sourcesContent":["//获取canvas元素：\r\nlet canvas = document.getElementById('canvas');\r\nlet ctx = canvas.getContext('2d');\r\n//功能按钮：\r\nlet brush = document.getElementById('brush');\r\nlet eraser = document.getElementById('eraser');\r\nlet undo = document.getElementById('undo');\r\nlet reSetCanvas = document.getElementById('clear');\r\nlet save = document.getElementById('save');\r\n//画笔颜色选择按钮：\r\nlet colorBtn = document.getElementsByClassName('color-item');\r\n//画笔粗细拖拽按钮：\r\nlet range = document.getElementById('range');\r\n\r\n//设置信号量：\r\n//默认非橡皮擦状态\r\nlet clear = false;\r\n//画笔默认宽度为4\r\nlet lWidth = 4;\r\n\r\n//设置画布尺寸\r\nautoSetSize(canvas);\r\n//我感觉多次一举，画板默认就是白色啊，只需要给一个默认画笔填充颜色就可以了啊\r\nsetCanvasBg('white');\r\n//设置画笔默认样式：\r\nctx.fillStyle = 'black';\r\nctx.strokeStyle = 'black';\r\n\r\n//监听用户操作\r\nlistenToUser(canvas);\r\n//根据颜色按钮获取画笔颜色\r\ngetColor();\r\n\r\n//窗口被关闭/刷新时，触发该事件：\r\nwindow.onbeforeunload = () => {\r\n    return 'Reload site?';\r\n};\r\n\r\n//定义设置画布尺寸函数\r\nfunction autoSetSize(canvas) {\r\n    //定义设置画布尺寸函数\r\n    function canvasSetSize() {\r\n        let clientWidth = document.documentElement.clientWidth;\r\n        let clientHeight = document.documentElement.clientHeight;\r\n        canvas.width = clientWidth;\r\n        canvas.height = clientHeight;\r\n    }\r\n\r\n    canvasSetSize();\r\n    //视口变化时画布尺寸重新设置：\r\n    window.onresize = () => {\r\n        canvasSetSize();\r\n    };\r\n}\r\n\r\n//设置画板背景函数：\r\nfunction setCanvasBg(color) {\r\n    //设置填充颜色\r\n    ctx.fillStyle = color;\r\n    //绘制一个填充矩形：\r\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n}\r\n\r\n//定义画点函数：\r\nfunction drawPoint(x, y) {\r\n    //what?\r\n    ctx.save();\r\n    //如果此时是橡皮擦状态：\r\n    if (clear) {\r\n        //what?\r\n        ctx.clip();\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        ctx.restore();\r\n    } else {\r\n        //画点（逻辑就是画一个圆，填充这个圆）\r\n        ctx.beginPath();\r\n        ctx.arc(x, y, 1, 0, Math.PI * 2);\r\n        ctx.fill();\r\n        console.log(\"画点成功\");\r\n    }\r\n}\r\n\r\n//定义画线函数：\r\nfunction drawLine(x1, y1, x2, y2) {\r\n    //样式初始化\r\n    ctx.lineWidth = lWidth;\r\n    //lineCap和lineJoin作用是画线时无缝隙，使其顺滑\r\n    ctx.lineCap = 'round';\r\n    ctx.lineJoin = 'round';\r\n    //如果现在是橡皮擦状态：\r\n    if (clear) {\r\n        //what?\r\n        ctx.save();\r\n        ctx.globalCompositeOperation = 'destination-out';\r\n        ctx.beginPath();\r\n        ctx.moveTo(x1, y1);\r\n        ctx.lineTo(x2, y2);\r\n        ctx.stroke();\r\n        ctx.closePath();\r\n        ctx.clip();\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        ctx.restore();\r\n    } else {\r\n        ctx.beginPath();\r\n        ctx.moveTo(x1, y1);\r\n        ctx.lineTo(x2, y2);\r\n        ctx.stroke();\r\n    }\r\n}\r\n\r\nfunction listenToUser(canvas) {\r\n    //设置信号量\r\n    //当前绘制状态信号量\r\n    let painting = false;\r\n    //最后坐标信号量：\r\n    let lastPoint = {x: undefined, y: undefined};\r\n    //判断是否是手机设备（通过触摸API判断）\r\n    if (document.body.ontouchstart !== undefined) {\r\n        //触摸开始时画一个点\r\n        canvas.ontouchstart = function (e) {\r\n            //ctx.getImageData返回一个ImageData对象，用来描述canvas区域隐含的像素数据，\r\n            //这个区域通过矩形表示，起始点为(sx, sy)、宽为sw、高为sh。\r\n            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n            saveData(imageData);\r\n            painting = true;\r\n            let x = e.touches[0].clientX;\r\n            let y = e.touches[0].clientY;\r\n            lastPoint = {x: x, y: y};\r\n            // 通过将当前状态放入栈中，保存 canvas 全部状态的方法。\r\n            ctx.save();\r\n            //调用画点函数：\r\n            drawPoint(x, y);\r\n        };\r\n        // 触摸移动时画线\r\n        canvas.ontouchmove = function (e) {\r\n            if (painting) {\r\n                let x = e.touches[0].clientX;\r\n                let y = e.touches[0].clientY;\r\n                let newPoint = {x: x, y: y};\r\n                //调用画线函数：\r\n                drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y);\r\n                //更新信号量：\r\n                lastPoint = newPoint;\r\n            }\r\n        };\r\n        // 触摸结束时重置绘画状态信号量：\r\n        canvas.ontouchend = function () {\r\n            painting = false;\r\n        };\r\n    } else {\r\n        //鼠标按下时画一个点\r\n        canvas.onmousedown = function (e) {\r\n            //ctx.getImageData返回一个ImageData对象，用来描述canvas区域隐含的像素数据，\r\n            //这个区域通过矩形表示，起始点为(sx, sy)、宽为sw、高为sh。\r\n            let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n            saveData(imageData);\r\n            painting = true;\r\n            let x = e.clientX;\r\n            let y = e.clientY;\r\n            lastPoint = {x: x, y: y};\r\n            // 通过将当前状态放入栈中，保存 canvas 全部状态的方法。\r\n            ctx.save();\r\n            //调用画点函数：\r\n            drawPoint(x, y);\r\n        };\r\n        // 鼠标按下移动时画线\r\n        canvas.onmousemove = function (e) {\r\n            // 判断信号量是否为true,为true时才能画线\r\n            if (painting) {\r\n                let x = e.clientX;\r\n                let y = e.clientY;\r\n                let newPoint = {x: x, y: y};\r\n                //调用画线函数：\r\n                drawLine(lastPoint.x, lastPoint.y, newPoint.x, newPoint.y);\r\n                //更新信号量：\r\n                lastPoint = newPoint;\r\n            }\r\n        };\r\n        // 鼠标抬起时重置绘画状态信号量：\r\n        canvas.onmouseup = function () {\r\n            painting = false;\r\n        };\r\n    }\r\n}\r\n\r\n//监听画笔宽度拖动按钮的变化事件：\r\n//当按钮值变化时，更新画笔的粗细\r\nrange.onchange = function () {\r\n    lWidth = this.value;\r\n    console.log(lWidth);\r\n};\r\n\r\n//橡皮擦按钮点击事件：\r\neraser.onclick = function () {\r\n    this.classList.add('active');\r\n    brush.classList.remove('active');\r\n    clear = true;\r\n};\r\n\r\n//监听画笔点击事件\r\nbrush.onclick = function () {\r\n    this.classList.add('active');\r\n    eraser.classList.remove('active');\r\n    clear = false;\r\n};\r\n\r\n//清空按钮点击事件\r\nreSetCanvas.onclick = function () {\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n};\r\n\r\n//根据颜色按钮选中状态设置填充颜色和轮廓颜色：\r\nfunction getColor() {\r\n    //遍历colorBtn按钮，给所有按钮添加点击事件：\r\n    for (let i = 0; i < colorBtn.length; i++) {\r\n        colorBtn[i].onclick = function () {\r\n            //先去掉所有的按钮的类：active\r\n            //原生js无兄弟节点的API，所以只能再次遍历：\r\n            for (let j = 0; j < colorBtn.length; j++) {\r\n                colorBtn[j].classList.remove('active');\r\n            }\r\n            //给被点击的颜色按钮加上类active：\r\n            this.classList.add('active');\r\n            ctx.fillStyle = this.style.backgroundColor;\r\n            ctx.strokeStyle = this.style.backgroundColor;\r\n        };\r\n    }\r\n}\r\n\r\nlet history = [];//该数组存放历史记录\r\n//保存历史记录函数：\r\nfunction saveData(imageData) {\r\n    //如果历史记录已经有10条了，就删除第一条再进行存储\r\n    //这是为了防止卡顿，如果保存太多会卡\r\n    (history.length === 10) && (history.shift());\r\n    history.push(imageData);\r\n}\r\n\r\nundo.onclick = function () {\r\n    console.log(history);\r\n    if (history.length === 0) {\r\n        window.alert('您已经撤销到尽头，无法继续撤销');\r\n        return;\r\n    }\r\n    let imageData = history[history.length - 1];\r\n    // ctx.putImageData将数据从已有的 ImageData 对象绘制到位图的方法。\r\n    //就是说将上次保存的ImageData对象渲染到画布上\r\n    ctx.putImageData(imageData, 0, 0);\r\n    history.pop();\r\n};\r\n\r\n//保存按钮监听，点击后保存图片，这个很有用啊\r\nsave.onclick = function () {\r\n    // getDataURL方法返回一个包含图片展示的 data URI\r\n    //就是将当前画板的内容变为一个url\r\n    let imgUrl = canvas.toDataURL(\"image/png\");\r\n    let a = document.createElement(\"a\");\r\n    document.body.appendChild(a);\r\n    a.href = imgUrl;\r\n    // 此属性指示浏览器下载 URL 而不是导航到它，\r\n    // 因此将提示用户将其保存为本地文件。如果属性有一个值，那么此值将在下载保存过程中作为预填充的文件名\r\n    a.download = \"wangkuo\" + (new Date).getTime();\r\n    a.target = \"_blank\";\r\n    // click 方法可以用来模拟鼠标左键单击一个元素。\r\n    a.click();\r\n};\r\n\r\n"]}